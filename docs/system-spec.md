# Scholaverse - å­¸ç¿’æ­·ç¨‹å¡ç‰Œç€è¦½å¹³å°ï¼šç³»çµ±é–‹ç™¼è¦æ ¼æ›¸

> å°ˆæ¡ˆåç¨±ï¼šintro-ai
> ç¶²åŸŸï¼šapp.scholaverse.cc
> ç‰ˆæœ¬ï¼šv0.1.0 (åˆå§‹é–‹ç™¼)
> æ’°å¯«æ—¥æœŸï¼š2026-02-16
> å°æ‡‰è¨ˆç•«ï¼šæ•™è‚²éƒ¨æ•™å­¸å¯¦è¸ç ”ç©¶è¨ˆç•«ã€Œå¾å­¸ç¿’è©•åˆ†åˆ°è§’è‰²é¤Šæˆï¼šç”Ÿæˆå¼ AI æ”¯æŒä¸‹çš„éŠæˆ²åŒ–æ•™å­¸å¯¦è¸ã€

---

## 1. ç³»çµ±ç¸½è¦½

### 1.1 ç³»çµ±ç›®çš„

æœ¬å¹³å°ç‚ºã€Œäººå·¥æ™ºæ…§æ¦‚è«–ã€èª²ç¨‹é–‹ç™¼çš„å­¸ç¿’æ­·ç¨‹å¯è¦–åŒ–ç³»çµ±ã€‚å°‡å­¸ç”Ÿåœ¨ 5 å¤§å­¸ç¿’å–®å…ƒçš„è¡¨ç¾æ•¸æ“šï¼ˆèª²ç¨‹å®Œæˆåº¦ã€éš¨å ‚æ¸¬é©—ã€èª²å¾Œç·´ç¿’ç­‰ï¼‰ï¼Œé€éè©•åˆ†è½‰æ›è¦å‰‡å°æ‡‰ç‚º RPG è§’è‰²å±¬æ€§ï¼ˆç¨®æ—ã€è·æ¥­ã€è£å‚™ã€æ­¦å™¨ã€èƒŒæ™¯ç­‰ï¼‰ï¼Œå†ç”±ç”Ÿæˆå¼ AI ç”¢ç”Ÿå€‹æ€§åŒ–çš„è§’è‰²é ­åƒå¡ç‰Œã€‚å­¸ç”Ÿå¯ç™»å…¥å¹³å°ç€è¦½è‡ªå·±çš„å­¸ç¿’æ­·ç¨‹èˆ‡å¡ç‰Œæˆé•·éç¨‹ã€‚

### 1.2 åŸºç¤æ¶æ§‹

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   Cloudflare     â”‚
       ä½¿ç”¨è€… â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   Zero Trust     â”‚
      (å­¸ç”Ÿ/æ•™å¸«)       â”‚   + Tunnel       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚ app.scholaverse.cc
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  vm-web-server   â”‚ 192.168.50.111
                        â”‚  FastAPI + UI    â”‚ (æœ¬å°ˆæ¡ˆæ‰€åœ¨)
                        â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                           â”‚           â”‚
              å…§éƒ¨ API     â”‚           â”‚  å…§éƒ¨ API
                           â”‚           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚vm-ai-worker â”‚  â”‚ vm-db-storage   â”‚
                â”‚192.168.50.110â”‚  â”‚ 192.168.50.112    â”‚
                â”‚GPU/CUDA/AI  â”‚  â”‚ åœ–ç‰‡+Metadata   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **vm-web-server (192.168.50.111)**ï¼šæœ¬å°ˆæ¡ˆéƒ¨ç½²ä½ç½®ï¼ŒåŸ·è¡Œ FastAPI æ‡‰ç”¨ï¼Œå°å¤–æä¾› Web UI èˆ‡ APIã€‚
- **vm-ai-worker (192.168.50.110)**ï¼šGPU ä¸»æ©Ÿï¼ˆRTX 5080ï¼‰ï¼ŒåŸ·è¡Œ Stable Diffusion / FLUX.1 ç­‰æ–‡ç”Ÿåœ–æ¨¡å‹ã€‚æ¥æ”¶ prompt ç”¢ç”Ÿè§’è‰²å¡ç‰Œåœ–ç‰‡ã€‚
- **vm-db-storage (192.168.50.112)**ï¼šå„²å­˜ AI worker ç”¢ç”Ÿçš„åœ–ç‰‡æª”èˆ‡ metadataã€‚Web server åƒ…è®€å–ï¼Œä¸æŒä¹…åŒ–åœ–ç‰‡ã€‚
- **lxc-cloudflared**ï¼šCloudflare Tunnelï¼Œå·²é…ç½®å®Œæˆã€‚è™•ç† HTTPS çµ‚ç«¯èˆ‡ Zero Trust èªè­‰ã€‚

> **æ³¨æ„**ï¼šä»¥ä¸Š IP ç‚ºæš«å®šï¼Œæ—¥å¾Œå¯èƒ½è®Šå‹•ã€‚æ‰€æœ‰ VM ä½å€çš†é€éç’°å¢ƒè®Šæ•¸æˆ–è¨­å®šæª”é…ç½®ï¼Œä¸å¯«æ­»åœ¨ç¨‹å¼ç¢¼ä¸­ã€‚

### 1.3 æŠ€è¡“æ£§

| å±¤é¢ | æŠ€è¡“ | èªªæ˜ |
|------|------|------|
| èªè¨€ | Python 3.12+ | |
| å¥—ä»¶ç®¡ç† | uv | ä¸ä½¿ç”¨ pip |
| å¾Œç«¯æ¡†æ¶ | FastAPI | å·²å®‰è£ v0.129+ |
| ASGI Server | uvicorn | å·²å®‰è£ (standard) |
| æ¨¡æ¿å¼•æ“ | Jinja2 | FastAPI å…§å»ºæ”¯æ´ |
| å‰ç«¯äº’å‹• | HTMX | è¼•é‡ï¼Œç„¡éœ€ Node.js å»ºæ§‹å·¥å…· |
| CSS æ¡†æ¶ | Tailwind CSS (CDN) | æ­é…åƒç´ é¢¨æ ¼è‡ªå®šç¾©æ¨£å¼ |
| è³‡æ–™åº« | SQLite | æœ¬åœ° metadataã€å­¸ç”Ÿè³‡æ–™ã€session ç­‰ |
| ORM | SQLAlchemy (async) | æ­é… aiosqlite |
| HTTP å®¢æˆ¶ç«¯ | httpx | èˆ‡ vm-ai-worker / vm-db-storage é€šä¿¡ |
| æ¸¬è©¦ | pytest + pytest-asyncio | |
| ç‰ˆæœ¬æ§åˆ¶ | Git + GitHub | |
| éƒ¨ç½² | systemd + uvicorn | |

---

## 2. ä½¿ç”¨è€…è§’è‰²èˆ‡èªè­‰

### 2.1 ä½¿ç”¨è€…è§’è‰²

| è§’è‰² | èªªæ˜ | æ¬Šé™ç¯„åœ |
|------|------|----------|
| å­¸ç”Ÿ (student) | ä¿®èª²å­¸ç”Ÿï¼Œç´„ 50 äºº | æŸ¥çœ‹è‡ªå·±çš„å­¸ç¿’æ­·ç¨‹ã€ç€è¦½/ç”Ÿæˆè‡ªå·±çš„å¡ç‰Œã€æŸ¥çœ‹è§’è‰²å¤§å»³ |
| æ•™å¸« (teacher) | èª²ç¨‹æˆèª²æ•™å¸« | å…¨ç­å­¸ç¿’ç‹€æ³ç¸½è¦½ã€ç®¡ç†å­¸ç”Ÿå¸³è™Ÿã€æ‰‹å‹•åŒ¯å…¥æˆç¸¾ã€èª¿æ•´è§’è‰²é…ç½® |
| ç®¡ç†å“¡ (admin) | ç³»çµ±ç®¡ç†è€… | ç³»çµ±è¨­å®šã€å…¨éƒ¨æ¬Šé™ |

### 2.2 èªè­‰æ©Ÿåˆ¶

èªè­‰ç”± Cloudflare Zero Trust è™•ç†ï¼ŒWeb server é€é HTTP header å–å¾—å·²èªè­‰çš„ä½¿ç”¨è€…è³‡è¨Šï¼š

```
cf-access-authenticated-user-email: student@example.com
```

å¹³å°å…§éƒ¨æµç¨‹ï¼š
1. Middleware å¾ request header æ“·å– `cf-access-authenticated-user-email`ï¼ˆå­¸ç”Ÿä»¥ Gmail å¸³è™Ÿç™»å…¥ï¼‰
2. æŸ¥è©¢æœ¬åœ° SQLite è³‡æ–™åº«ï¼Œæ¯”å°è©² email æ˜¯å¦ç‚ºå·²è¨»å†Šçš„ä½¿ç”¨è€…
3. è‹¥å·²è¨»å†Šï¼šæ³¨å…¥ user ç‰©ä»¶è‡³ request.stateï¼Œç¹¼çºŒæ­£å¸¸æµç¨‹
4. è‹¥æœªè¨»å†Šï¼šé‡å°è‡³è¨»å†Šé é¢ `/register`
5. è·¯ç”±å±¤é€é dependency æª¢æŸ¥è§’è‰²æ¬Šé™

### 2.3 è‡ªåŠ©è¨»å†Šæµç¨‹

å­¸ç”Ÿé¦–æ¬¡ç™»å…¥æ™‚ï¼ˆemail ä¸å­˜åœ¨æ–¼è³‡æ–™åº«ï¼‰ï¼Œç³»çµ±å¼•å°è‡³è¨»å†Šé é¢ï¼š

1. é¡¯ç¤ºå·²èªè­‰çš„ Gmail emailï¼ˆå”¯è®€ï¼‰
2. è¦æ±‚å¡«å¯«**å­¸è™Ÿ**ï¼ˆç”¨æ–¼ç¶å®šèº«ä»½ï¼‰
3. è¦æ±‚å¡«å¯«**å§“å**
4. æäº¤å¾Œå»ºç«‹ student å¸³è™Ÿï¼Œemail èˆ‡å­¸è™Ÿç¶å®š
5. æ•™å¸«å¸³è™Ÿç”±ç®¡ç†å“¡é å…ˆå»ºç«‹æˆ–æ‰‹å‹•æå‡æ¬Šé™

> ä¸éœ€è¦è‡ªè¡Œå¯¦ä½œç™»å…¥/ç™»å‡ºï¼Œå…¨ç”± Cloudflare Zero Trust ç®¡ç†ã€‚
> ä¸é è¨­å­¸ç”Ÿåå–®ï¼Œæ¡ç”¨è‡ªåŠ©è¨»å†Šåˆ¶ã€‚

### 2.4 èªè­‰ç›¸é—œ API

| ç«¯é» | æ–¹æ³• | èªªæ˜ | æ¬Šé™ |
|------|------|------|------|
| (Middleware) | - | æ¯å€‹ request è‡ªå‹•è§£æ CF header | - |
| `GET /register` | GET | é¡¯ç¤ºè¨»å†Šé é¢ | æœªè¨»å†Šç”¨æˆ¶ |
| `POST /register` | POST | æäº¤è¨»å†Šï¼ˆå­¸è™Ÿ + å§“åï¼‰ | æœªè¨»å†Šç”¨æˆ¶ |

---

## 3. è³‡æ–™æ¨¡å‹

### 3.1 ER é—œä¿‚åœ–

```
Student â”€â”€1:Nâ”€â”€> LearningRecord â”€â”€N:1â”€â”€> Unit
Student â”€â”€1:Nâ”€â”€> Card
Student â”€â”€1:Nâ”€â”€> CardConfig
Card    â”€â”€N:1â”€â”€> CardConfig
Unit    â”€â”€1:Nâ”€â”€> LearningRecord
```

### 3.2 è³‡æ–™è¡¨å®šç¾©

#### 3.2.1 studentsï¼ˆå­¸ç”Ÿï¼‰

| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| id | INTEGER PK | è‡ªå¢ä¸»éµ |
| email | TEXT UNIQUE NOT NULL | Cloudflare èªè­‰ email |
| student_id | TEXT UNIQUE | å­¸è™Ÿ |
| name | TEXT NOT NULL | å§“å |
| role | TEXT NOT NULL DEFAULT 'student' | è§’è‰²ï¼šstudent / teacher / admin |
| tokens | INTEGER DEFAULT 0 | å¯ç”¨ä»£å¹£æ•¸é‡ï¼ˆç”¨æ–¼é‡æ–°ç”Ÿæˆå¡ç‰Œï¼‰ |
| created_at | DATETIME | å»ºç«‹æ™‚é–“ |
| updated_at | DATETIME | æ›´æ–°æ™‚é–“ |

#### 3.2.2 unitsï¼ˆå­¸ç¿’å–®å…ƒï¼‰

| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| id | INTEGER PK | è‡ªå¢ä¸»éµ |
| code | TEXT UNIQUE NOT NULL | å–®å…ƒä»£ç¢¼ï¼Œå¦‚ "unit_1", "unit_2" |
| name | TEXT NOT NULL | å–®å…ƒåç¨±ï¼Œå¦‚ã€Œå…ˆå‚™çŸ¥è­˜ç°¡ä»‹ã€ |
| description | TEXT | å–®å…ƒæè¿° |
| week_start | INTEGER | èµ·å§‹é€±æ¬¡ |
| week_end | INTEGER | çµæŸé€±æ¬¡ |
| unlock_attribute | TEXT NOT NULL | æ­¤å–®å…ƒå°æ‡‰è§£é–çš„è§’è‰²å±¬æ€§é¡åˆ¥ |
| sort_order | INTEGER | æ’åº |

é è¨­è³‡æ–™ï¼ˆ5 + 1 å–®å…ƒï¼‰ï¼š

| code | name | weeks | unlock_attribute |
|------|------|-------|-----------------|
| unit_1 | å…ˆå‚™çŸ¥è­˜ç°¡ä»‹ | 1-3 | race_genderï¼ˆç¨®æ—ã€æ€§åˆ¥ï¼‰|
| unit_2 | å¤šå±¤æ„ŸçŸ¥å™¨ (MLP) | 4-6 | class_bodyï¼ˆè·æ¥­ã€é«”å‹ï¼‰|
| unit_3 | å·ç©ç¥ç¶“ç¶²è·¯ (CNN) | 7-9 | equipmentï¼ˆæœé£¾è£å‚™å¤–è§€ï¼‰|
| unit_4 | å¾ªç’°ç¥ç¶“ç¶²è·¯ (RNN/LSTM/GRU) | 10-12 | weaponï¼ˆæ­¦å™¨ï¼‰|
| unit_5 | æ·±åº¦å­¸ç¿’é€²éšæŠ€è¡“ | 13-16 | backgroundï¼ˆèƒŒæ™¯å ´æ™¯ï¼‰|
| unit_6 | è‡ªä¸»å­¸ç¿’ | 17-18 | expression_poseï¼ˆè¡¨æƒ…ã€å§¿å‹¢ã€å¤–æ¡†ï¼‰|

#### 3.2.3 learning_recordsï¼ˆå­¸ç¿’ç´€éŒ„ï¼‰

| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| id | INTEGER PK | è‡ªå¢ä¸»éµ |
| student_id | INTEGER FK -> students.id | å­¸ç”Ÿ |
| unit_id | INTEGER FK -> units.id | å°æ‡‰å–®å…ƒ |
| preview_score | REAL | é ç¿’è©•åˆ† (0-100) |
| quiz_score | REAL | éš¨å ‚æ¸¬é©—è©•åˆ† (0-100) |
| homework_score | REAL | èª²å¾Œç·´ç¿’è©•åˆ† (0-100) |
| completion_rate | REAL | TronClass èª²ç¨‹å®Œæˆåº¦ (0-100%) |
| bonus_points | INTEGER DEFAULT 0 | é¡å¤–ç·´ç¿’é¡Œæ‰€å¾—é»æ•¸ |
| imported_at | DATETIME | åŒ¯å…¥æ™‚é–“ |
| updated_at | DATETIME | æ›´æ–°æ™‚é–“ |

> UNIQUE constraint on (student_id, unit_id)

#### 3.2.4 card_configsï¼ˆå¡ç‰Œé…ç½®ï¼‰

| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| id | INTEGER PK | è‡ªå¢ä¸»éµ |
| student_id | INTEGER FK -> students.id | å­¸ç”Ÿ |
| unit_id | INTEGER FK -> units.id | å°æ‡‰å–®å…ƒ |
| attribute_type | TEXT NOT NULL | å±¬æ€§é¡åˆ¥ (race, gender, class, body, equipment, weapon, background, expression, pose) |
| attribute_value | TEXT NOT NULL | é¸æ“‡çš„å€¼ï¼Œå¦‚ "elf", "mage", "iron_armor" |
| available_options | TEXT | JSON: æ ¹æ“šåˆ†æ•¸å¯é¸çš„é¸é …åˆ—è¡¨ |
| created_at | DATETIME | |
| updated_at | DATETIME | |

> UNIQUE constraint on (student_id, unit_id, attribute_type)

#### 3.2.5 cardsï¼ˆå¡ç‰Œï¼‰

| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| id | INTEGER PK | è‡ªå¢ä¸»éµ |
| student_id | INTEGER FK -> students.id | å­¸ç”Ÿ |
| config_snapshot | TEXT | JSON: ç”Ÿæˆç•¶ä¸‹çš„å®Œæ•´é…ç½®å¿«ç…§ |
| prompt | TEXT | é€çµ¦ AI worker çš„å®Œæ•´ prompt |
| image_url | TEXT | åœ–ç‰‡åœ¨ vm-db-storage ä¸Šçš„è·¯å¾‘/URL |
| thumbnail_url | TEXT | ç¸®åœ–è·¯å¾‘ |
| status | TEXT DEFAULT 'pending' | pending / generating / completed / failed |
| border_style | TEXT | å¡ç‰Œå¤–æ¡†ï¼šcopper / silver / gold |
| level_number | INTEGER | å¡ç‰Œç­‰ç´šæ•¸å­— (1-10)ï¼Œå°æ‡‰èª²ç¨‹ç¸½å®Œæˆåº¦ |
| is_latest | BOOLEAN DEFAULT TRUE | æ˜¯å¦ç‚ºè©²å­¸ç”Ÿæœ€æ–°çš„å¡ç‰Œ |
| generated_at | DATETIME | ç”Ÿæˆå®Œæˆæ™‚é–“ |
| created_at | DATETIME | å»ºç«‹æ™‚é–“ |

#### 3.2.6 token_transactionsï¼ˆä»£å¹£äº¤æ˜“ç´€éŒ„ï¼‰

| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| id | INTEGER PK | è‡ªå¢ä¸»éµ |
| student_id | INTEGER FK -> students.id | å­¸ç”Ÿ |
| amount | INTEGER | æ­£ç‚ºç²å¾—ã€è² ç‚ºèŠ±è²» |
| reason | TEXT | åŸå› æè¿°ï¼Œå¦‚ "å®Œæˆå‰å¾Œæ¸¬å•å·"ã€"é‡æ–°ç”Ÿæˆå¡ç‰Œ" |
| created_at | DATETIME | |

---

## 4. è©•åˆ†è½‰æ›è¦å‰‡

### 4.1 ç¸½é«”è¦å‰‡

æ¯å€‹å­¸ç¿’å–®å…ƒçš„éš¨å ‚æ¸¬é©—åˆ†æ•¸æ±ºå®šè©²å–®å…ƒæ‰€å°æ‡‰çš„è§’è‰²å±¬æ€§å¯é¸ç¯„åœã€‚åˆ†æ•¸è¶Šé«˜ï¼Œå¯é¸é¸é …è¶Šå¤šã€å“è³ªè¶Šé«˜ã€‚

### 4.2 å–®å…ƒå°æ‡‰å±¬æ€§èˆ‡åˆ†ç´š

#### å–®å…ƒ 1ï¼šç¨®æ—èˆ‡æ€§åˆ¥

| åˆ†æ•¸å€é–“ | å¯é¸ç¨®æ— |
|----------|----------|
| 90-100 | ç²¾éˆã€äººé¡ã€ç¸äººã€çŸ®äººã€é¾æ—ï¼ˆå…¨éƒ¨å¯é¸ï¼‰|
| 75-89 | ç²¾éˆã€äººé¡ã€ç¸äººã€çŸ®äºº |
| 60-74 | äººé¡ã€ç¸äººã€çŸ®äºº |
| 40-59 | çŸ®äººã€å°ç²¾éˆ |
| 0-39 | æ¤ç‰©ã€å²èŠå§† |

æ€§åˆ¥ï¼šæ‰€æœ‰åˆ†æ•¸å€é–“çš†å¯è‡ªç”±é¸æ“‡ã€‚

#### å–®å…ƒ 2ï¼šè·æ¥­èˆ‡é«”å‹

| åˆ†æ•¸å€é–“ | å¯é¸è·æ¥­ |
|----------|----------|
| 90-100 | å¤§æ³•å¸«ã€è–é¨å£«ã€éŠä¿ ã€åˆºå®¢ã€ç‰§å¸«ï¼ˆå…¨éƒ¨ï¼‰|
| 75-89 | æ³•å¸«ã€æˆ°å£«ã€å¼“ç®­æ‰‹ã€ç‰§å¸« |
| 60-74 | æˆ°å£«ã€å¼“ç®­æ‰‹ã€ç‰§å¸« |
| 40-59 | æ°‘å…µã€å­¸å¾’ |
| 0-39 | è¾²å¤« |

é«”å‹ä¾èª²å¾Œç·´ç¿’è©•åˆ†ï¼šçµå¯¦ç²¾å£¯ / æ¨™æº– / çº–ç´°ç˜¦å¼±ã€‚

#### å–®å…ƒ 3ï¼šæœé£¾è£å‚™å¤–è§€

| åˆ†æ•¸å€é–“ | è£å‚™å“è³ª |
|----------|----------|
| 90-100 | å‚³èªªç´šï¼ˆè¯éº—ç²¾ç·»ï¼‰|
| 75-89 | ç²¾è‰¯ç´šï¼ˆå®Œå¥½ç²¾ç¾ï¼‰|
| 60-74 | æ™®é€šç´šï¼ˆä¸€èˆ¬å®Œå¥½ï¼‰|
| 40-59 | ç²—ç³™ç´šï¼ˆç°¡é™‹ï¼‰|
| 0-39 | ç ´æç´šï¼ˆç ´çˆ›ï¼‰|

#### å–®å…ƒ 4ï¼šæ­¦å™¨

| åˆ†æ•¸å€é–“ | æ­¦å™¨å“è³ª |
|----------|----------|
| 90-100 | ç¥å™¨ç´š + å…¨æ­¦å™¨é¡å‹å¯é¸ |
| 75-89 | ç²¾è‰¯ç´š + å¤šæ•¸æ­¦å™¨å¯é¸ |
| 60-74 | æ™®é€šç´š + éƒ¨åˆ†æ­¦å™¨å¯é¸ |
| 40-59 | ç²—ç³™ç´š + å°‘é‡æ­¦å™¨ |
| 0-39 | æœ¨æ£ã€çŸ³é ­ |

æ­¦å™¨é¡å‹ä¾è·æ¥­æœ‰å°æ‡‰é—œä¿‚ï¼ˆå¦‚æ³•å¸«â†’æ³•æ–/é­”æ³•æ›¸ï¼Œæˆ°å£«â†’é•·åŠ/ç›¾ç‰Œï¼‰ã€‚

#### å–®å…ƒ 5ï¼šèƒŒæ™¯å ´æ™¯

| åˆ†æ•¸å€é–“ | å ´æ™¯ |
|----------|------|
| 90-100 | çš‡å®®ç‹åº§ã€é¾å·¢ã€å¤©ç©ºä¹‹åŸ |
| 75-89 | åŸå ¡ã€é­”æ³•å¡” |
| 60-74 | åŸé®ã€å¸‚é›† |
| 40-59 | å°æ‘è½ã€è’é‡ |
| 0-39 | ç ´æ•—å»¢å¢Ÿ |

#### è‡ªä¸»å­¸ç¿’å–®å…ƒï¼šè¡¨æƒ…ã€å§¿å‹¢ã€å¤–æ¡†

- è¡¨æƒ…ï¼šä¾è©•åˆ† â†’ ç‹è€…é¢¨ç¯„ / æ¿€æ˜‚ / è‡ªä¿¡ / å¹³éœ / ç–²æ†Š
- å§¿å‹¢ï¼šä¾è©•åˆ† â†’ è¡é‹’é™·é™£ / æŒæ­¦å™¨å‚™æˆ° / ç«™ç«‹ / è¹²å
- å¡ç‰Œå¤–æ¡†ï¼šä¾å­¸ç¿’é€±æ¬¡é€²å±• â†’ éŠ…é‚Š / éŠ€é‚Š / é‡‘é‚Š
- å¡ç‰Œæ•¸å­— (1-10)ï¼šå°æ‡‰èª²ç¨‹ç¸½å®Œæˆåº¦ç™¾åˆ†æ¯”

### 4.3 ä»£å¹£æ©Ÿåˆ¶

| ç²å–æ–¹å¼ | ä»£å¹£æ•¸é‡ |
|----------|----------|
| å®Œæˆå‰æ¸¬å•å· | +5 |
| å®Œæˆå¾Œæ¸¬å•å· | +5 |
| å¡«å¯«åæ€å›é¥‹å–® | +3 |
| å¡«å¯«æœŸæœ«æ•™å­¸å•å· | +5 |
| èª²ç¨‹è¨è«–å€ç™¼æ–‡ | +2/ç¯‡ |
| AI çŸ¥è­˜ç·´ç¿’é¡Œç­”å° | +1/é¡Œ |

| èŠ±è²»æ–¹å¼ | ä»£å¹£æ¶ˆè€— |
|----------|----------|
| ä¿®æ”¹å–®ä¸€å±¬æ€§é…ç½® | -5 |
| é‡æ–°ç”Ÿæˆå®Œæ•´å¡ç‰Œ | -10 |
| å»ºç«‹ç¬¬äºŒéš»è§’è‰² | -20 |

---

## 5. API è¨­è¨ˆ

### 5.1 é é¢è·¯ç”±ï¼ˆè¿”å› HTMLï¼‰

| ç«¯é» | æ–¹æ³• | èªªæ˜ | æ¬Šé™ |
|------|------|------|------|
| `GET /` | GET | é¦–é /å„€è¡¨æ¿ | å·²èªè­‰ |
| `GET /cards` | GET | æˆ‘çš„å¡ç‰Œ gallery | student |
| `GET /cards/{card_id}` | GET | å–®å¼µå¡ç‰Œè©³æƒ… | student (own) |
| `GET /hall` | GET | è§’è‰²å¤§å»³ï¼ˆå…¨ç­æœ€æ–°å¡ç‰Œï¼‰ | å·²èªè­‰ |
| `GET /progress` | GET | æˆ‘çš„å­¸ç¿’æ­·ç¨‹ç¸½è¦½ | student |
| `GET /progress/{unit_code}` | GET | å–®ä¸€å–®å…ƒå­¸ç¿’è©³æƒ… + å±¬æ€§é…ç½® | student |
| `GET /admin` | GET | æ•™å¸«ç®¡ç†å¾Œå° | teacher/admin |
| `GET /admin/students` | GET | å­¸ç”Ÿç®¡ç†åˆ—è¡¨ | teacher/admin |
| `GET /admin/students/{id}` | GET | å–®ä¸€å­¸ç”Ÿè©³æƒ… | teacher/admin |
| `GET /admin/import` | GET | æˆç¸¾åŒ¯å…¥é é¢ | teacher/admin |

### 5.2 API è·¯ç”±ï¼ˆè¿”å› JSONï¼ŒHTMX partialï¼Œæˆ–åŸ·è¡Œæ“ä½œï¼‰

| ç«¯é» | æ–¹æ³• | èªªæ˜ | æ¬Šé™ |
|------|------|------|------|
| `POST /api/cards/generate` | POST | æäº¤å¡ç‰Œç”Ÿæˆè«‹æ±‚ | student |
| `GET /api/cards/{card_id}/status` | GET | æŸ¥è©¢å¡ç‰Œç”Ÿæˆç‹€æ…‹ | student (own) |
| `PUT /api/config/{unit_code}` | PUT | æ›´æ–°è§’è‰²å±¬æ€§é…ç½® | student |
| `GET /api/config/{unit_code}/options` | GET | å–å¾—å¯é¸å±¬æ€§é¸é …ï¼ˆä¾åˆ†æ•¸ï¼‰ | student |
| `POST /api/admin/import` | POST | ä¸Šå‚³ä¸¦åŒ¯å…¥ TronClass æˆç¸¾ CSV | teacher/admin |
| `PUT /api/admin/students/{id}/config` | PUT | æ•™å¸«æ‰‹å‹•èª¿æ•´å­¸ç”Ÿè§’è‰²é…ç½® | teacher/admin |
| `GET /api/admin/dashboard` | GET | å…¨ç­å­¸ç¿’ç‹€æ³çµ±è¨ˆè³‡æ–™ | teacher/admin |
| `POST /api/tokens/spend` | POST | èŠ±è²»ä»£å¹£ | student |
| `GET /api/tokens/history` | GET | ä»£å¹£äº¤æ˜“ç´€éŒ„ | student |

### 5.3 VM é–“å…§éƒ¨ API

#### vm-web-server â†’ vm-ai-worker

vm-web-server **ä¸è² è²¬ç”Ÿæˆ prompt**ï¼ˆæœ¬æ©Ÿç„¡ LLMï¼‰ã€‚è€Œæ˜¯å°‡å­¸ç¿’æ•¸æ“šèˆ‡è§’è‰²é…ç½®å‚³é€çµ¦ vm-ai-workerï¼Œç”±å…¶ï¼š
1. ä½¿ç”¨ LLM æ¨¡å‹åˆ†æå­¸ç¿’æ•¸æ“šï¼Œç”Ÿæˆåˆé©çš„æ–‡ç”Ÿåœ–æç¤ºè© (prompt)
2. å‘¼å«æ–‡ç”Ÿåœ–æ¨¡å‹ï¼ˆå¦‚ FLUX.1 / Stable Diffusionï¼‰ç”¢ç”Ÿå¡ç‰Œåœ–ç‰‡
3. å°‡åœ–ç‰‡å„²å­˜è‡³ vm-db-storage

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `POST http://192.168.50.110/api/generate` | POST | é€å‡ºå¡ç‰Œç”Ÿæˆè«‹æ±‚ï¼ˆå­¸ç¿’æ•¸æ“š + è§’è‰²é…ç½®ï¼‰|
| `GET http://192.168.50.110/api/jobs/{job_id}` | GET | æŸ¥è©¢ç”Ÿæˆä»»å‹™ç‹€æ…‹ |

Request body (generate):
```json
{
  "job_id": "uuid",
  "student_id": 1,
  "card_id": 1,
  "card_config": {
    "race": "elf",
    "gender": "female",
    "class": "mage",
    "body": "slim",
    "equipment": "legendary_robe",
    "weapon": "staff_of_arcane",
    "background": "magic_tower",
    "expression": "confident",
    "pose": "casting_spell",
    "border": "gold",
    "level": 8
  },
  "learning_data": {
    "unit_scores": {
      "unit_1": {"quiz": 92, "homework": 85, "completion": 95},
      "unit_2": {"quiz": 88, "homework": 78, "completion": 90},
      "unit_3": {"quiz": 76, "homework": 80, "completion": 85},
      "unit_4": {"quiz": 82, "homework": 70, "completion": 80},
      "unit_5": {"quiz": 90, "homework": 88, "completion": 92}
    },
    "overall_completion": 88.4
  },
  "style_hint": "16-bit pixel art, fantasy RPG character card",
  "callback_url": "http://192.168.50.111/api/internal/generation-callback"
}
```

> vm-ai-worker æ”¶åˆ°å¾Œï¼Œç”±å…¶å…§éƒ¨ LLM æ ¹æ“š card_config + learning_data è‡ªå‹•çµ„åˆæœ€ä½³ promptï¼Œå†å‘¼å«æ–‡ç”Ÿåœ–æ¨¡å‹ç”¢åœ–ã€‚

#### vm-web-server â†’ vm-db-storage

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `GET http://192.168.50.112/api/images/{image_path}` | GET | è®€å–åœ–ç‰‡æª”æ¡ˆ |
| `GET http://192.168.50.112/api/images/list?student_id=1` | GET | åˆ—å‡ºæŸå­¸ç”Ÿæ‰€æœ‰åœ–ç‰‡ |
| `GET http://192.168.50.112/api/metadata/{card_id}` | GET | è®€å–åœ–ç‰‡ metadata |

#### vm-ai-worker â†’ vm-web-server (callback)

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `POST http://192.168.50.111/api/internal/generation-callback` | POST | AI worker å®Œæˆå¾Œå›èª¿ |

Callback body:
```json
{
  "job_id": "uuid",
  "card_id": 1,
  "status": "completed",
  "image_path": "/students/1/cards/card_001.png",
  "thumbnail_path": "/students/1/cards/card_001_thumb.png",
  "generated_at": "2026-02-16T12:00:00Z"
}
```

> **Mock ç­–ç•¥**ï¼šåœ¨ vm-ai-worker å’Œ vm-db-storage å°šæœªä¸Šç·šä¹‹å‰ï¼Œæ‰€æœ‰å°å¤–éƒ¨ VM çš„å‘¼å«éƒ½é€é service å±¤æŠ½è±¡ï¼Œé–‹ç™¼éšæ®µä½¿ç”¨ mock å¯¦ä½œå›å‚³å‡è³‡æ–™èˆ‡ç¤ºç¯„åœ–ç‰‡ã€‚

---

## 6. å‰ç«¯ UI è¨­è¨ˆè¦ç¯„

### 6.1 è¦–è¦ºé¢¨æ ¼

ä¾æ“šåƒè€ƒæª”æ¡ˆ `ref/PixelArt_UI_example.jpeg` èˆ‡ `ref/PixelArt_UI_prompt_example.txt`ï¼ŒUI æ¡ç”¨ **Pixel Art åƒç´ é¢¨æ ¼**ï¼Œç‡Ÿé€ ä¸­ä¸–ç´€å¥‡å¹» RPG éŠæˆ²æ„Ÿã€‚

æ ¸å¿ƒè¦–è¦ºé—œéµè©ï¼š
- **Pixel Art / 16-bit** é¢¨æ ¼çš„åœ–ç¤ºèˆ‡è£é£¾å…ƒç´ 
- **Medieval Fantasy RPG** ä»‹é¢é¢¨æ ¼
- **Parchment Texture** ç¾Šçš®ç´™è³ªæ„ŸèƒŒæ™¯
- **Gold borders / Brass trim** é‡‘é‚Šè£é£¾é‚Šæ¡†
- **Dark Green and Gold Color Palette** æ·±ç¶ èˆ‡é‡‘è‰²é…è‰²

### 6.2 é…è‰²æ–¹æ¡ˆ

| ç”¨é€” | è‰²ç¢¼ | èªªæ˜ |
|------|------|------|
| ä¸»èƒŒæ™¯ | #1a1a2e / #0f0c29 | æ·±è‰²èƒŒæ™¯ï¼ˆå¤œç©ºæ„Ÿï¼‰ |
| é¢æ¿èƒŒæ™¯ | #2d3a1a / #1e3a1a | æ·±ç¶ è‰²é¢æ¿ |
| ä¸»è¦å¼·èª¿è‰² | #d4a847 / #c8a84e | é‡‘è‰²ï¼ˆé‚Šæ¡†ã€æ¨™é¡Œï¼‰ |
| æ¬¡è¦å¼·èª¿è‰² | #8b6914 | æ·±é‡‘/é»ƒéŠ…è‰² |
| æ–‡å­—ä¸»è‰² | #e8d5b0 | æš–ç™½/ç¾Šçš®ç´™è‰² |
| æ–‡å­—æ¬¡è‰² | #a89070 | æ·¡æ£•è‰² |
| æˆåŠŸè‰² | #4ade80 | ç¶ è‰²ï¼ˆå®Œæˆã€é€šéï¼‰ |
| è­¦å‘Šè‰² | #f59e0b | ç¥ç€è‰² |
| å±éšªè‰² | #ef4444 | ç´…è‰² |
| å¡ç‰ŒéŠ…é‚Š | #b87333 | |
| å¡ç‰ŒéŠ€é‚Š | #c0c0c0 | |
| å¡ç‰Œé‡‘é‚Š | #ffd700 | |

### 6.3 å­—å‹

- æ¨™é¡Œ/UI å…ƒç´ ï¼šåƒç´ é¢¨æ ¼ web fontï¼ˆå¦‚ Press Start 2P æˆ– DotGothic16ï¼‰
- å…§æ–‡/ä¸­æ–‡ï¼šNoto Sans TCï¼ˆç¢ºä¿ä¸­æ–‡å¯è®€æ€§ï¼‰
- æ•¸å­—/æ•¸æ“šï¼šmonospace åƒç´ å­—å‹

### 6.4 é é¢ Wireframe èªªæ˜

#### é¦–é ï¼ˆå„€è¡¨æ¿ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [åƒç´ é¢¨ Logo] Scholaverse    [ä½¿ç”¨è€… email] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è§’è‰²é è¦½å€     â”‚  â”‚ å­¸ç¿’é€²åº¦ç¸½è¦½       â”‚   â”‚
â”‚  â”‚ (æœ€æ–°å¡ç‰Œç¸®åœ–)  â”‚  â”‚ Unit 1 â–ˆâ–ˆâ–ˆâ–ˆâ–‘ 80% â”‚   â”‚
â”‚  â”‚               â”‚  â”‚ Unit 2 â–ˆâ–ˆâ–ˆâ–‘â–‘ 60% â”‚   â”‚
â”‚  â”‚  Lv.5 ç²¾éˆæ³•å¸« â”‚  â”‚ Unit 3 â–ˆâ–ˆâ–‘â–‘â–‘ 40% â”‚   â”‚
â”‚  â”‚  [é‡‘é‚Šå¡ç‰Œ]    â”‚  â”‚ Unit 4 ğŸ”’ æœªè§£é–   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ Unit 5 ğŸ”’ æœªè§£é–   â”‚   â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¿«é€Ÿæ“ä½œ                              â”‚   â”‚
â”‚  â”‚ [ç€è¦½æˆ‘çš„å¡ç‰Œ]  [è§’è‰²å¤§å»³]  [å­¸ç¿’æ­·ç¨‹] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  ä»£å¹£é¤˜é¡: ğŸª™ 15                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¡ç‰Œ Gallery
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æˆ‘çš„å¡ç‰Œæ”¶è—                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚éŠ…é‚Š  â”‚  â”‚éŠ€é‚Š  â”‚  â”‚éŠ€é‚Š  â”‚  â”‚é‡‘é‚Š  â”‚       â”‚
â”‚  â”‚ Lv.2â”‚  â”‚ Lv.4â”‚  â”‚ Lv.6â”‚  â”‚ Lv.8â”‚       â”‚
â”‚  â”‚[åœ–ç‰‡]â”‚  â”‚[åœ–ç‰‡]â”‚  â”‚[åœ–ç‰‡]â”‚  â”‚[åœ–ç‰‡]â”‚       â”‚
â”‚  â”‚è¾²å¤«  â”‚  â”‚æ³•å¸«  â”‚  â”‚æ³•å¸«  â”‚  â”‚å¤§æ³•å¸«â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                             â”‚
â”‚  é»æ“Šå¡ç‰ŒæŸ¥çœ‹è©³ç´°è³‡è¨Š                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è§’è‰²å¤§å»³
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš” è§’è‰²å¤§å»³ â€” å…¨ç­å†’éšªè€…                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å­¸ç”ŸAâ”‚ â”‚ å­¸ç”ŸBâ”‚ â”‚ å­¸ç”ŸCâ”‚ â”‚ å­¸ç”ŸDâ”‚ â”‚ å­¸ç”ŸEâ”‚  â”‚
â”‚  â”‚Lv.8 â”‚ â”‚Lv.7 â”‚ â”‚Lv.6 â”‚ â”‚Lv.5 â”‚ â”‚Lv.4 â”‚  â”‚
â”‚  â”‚[å¡ç‰Œ]â”‚ â”‚[å¡ç‰Œ]â”‚ â”‚[å¡ç‰Œ]â”‚ â”‚[å¡ç‰Œ]â”‚ â”‚[å¡ç‰Œ]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  ... (grid æ’åˆ—ï¼Œæ¯äººé¡¯ç¤ºæœ€æ–°ä¸€å¼µ)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å­¸ç¿’æ­·ç¨‹é 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“œ æˆ‘çš„å­¸ç¿’æ­·ç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  å–®å…ƒ 1: å…ˆå‚™çŸ¥è­˜ç°¡ä»‹          [å·²å®Œæˆ âœ“]    â”‚
â”‚  â”œ é ç¿’è©•åˆ†: 85    â†’ è§£é–: ç¨®æ—é¸æ“‡ (5é …)   â”‚
â”‚  â”œ éš¨å ‚æ¸¬é©—: 92    â†’ ç›®å‰é¸æ“‡: ç²¾éˆ          â”‚
â”‚  â”œ èª²å¾Œç·´ç¿’: 78    â†’ æ€§åˆ¥: å¥³æ€§              â”‚
â”‚  â”” å®Œæˆåº¦: 95%     [æŸ¥çœ‹/ä¿®æ”¹é…ç½®]           â”‚
â”‚                                             â”‚
â”‚  å–®å…ƒ 2: å¤šå±¤æ„ŸçŸ¥å™¨ (MLP)     [é€²è¡Œä¸­ â–¶]    â”‚
â”‚  â”œ é ç¿’è©•åˆ†: 70    â†’ è§£é–: è·æ¥­é¸æ“‡ (3é …)   â”‚
â”‚  â”œ éš¨å ‚æ¸¬é©—: --    â†’ å¾…å®Œæˆ                  â”‚
â”‚  â”” ...                                      â”‚
â”‚                                             â”‚
â”‚  å–®å…ƒ 3: å·ç©ç¥ç¶“ç¶²è·¯ (CNN)    [ğŸ”’ æœªè§£é–]   â”‚
â”‚  ...                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.5 éŸ¿æ‡‰å¼è¨­è¨ˆ

- Desktop (>1024px)ï¼šä¸‰æ¬„/Grid ä½ˆå±€
- Tablet (768-1024px)ï¼šå…©æ¬„
- Mobile (<768px)ï¼šå–®æ¬„ï¼Œå¡ç‰Œ gallery æ”¹ç‚ºæ©«å‘æ»‘å‹•

---

## 7. å°ˆæ¡ˆç›®éŒ„çµæ§‹

```
intro-ai/
â”œâ”€â”€ main.py                      # FastAPI app å…¥å£ã€å•Ÿå‹•é…ç½®
â”œâ”€â”€ pyproject.toml               # uv å¥—ä»¶ç®¡ç†
â”œâ”€â”€ uv.lock
â”œâ”€â”€ .env                         # ç’°å¢ƒè®Šæ•¸ï¼ˆä¸å…¥ç‰ˆæ§ï¼‰
â”œâ”€â”€ .env.example                 # ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ system-spec.md           # æœ¬è¦æ ¼æ›¸
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py                # è¨­å®šç®¡ç†ï¼ˆè®€å– .envï¼‰
â”‚   â”œâ”€â”€ database.py              # SQLAlchemy engine & session
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ student.py           # Student model
â”‚   â”‚   â”œâ”€â”€ unit.py              # Unit model
â”‚   â”‚   â”œâ”€â”€ learning_record.py   # LearningRecord model
â”‚   â”‚   â”œâ”€â”€ card.py              # Card model
â”‚   â”‚   â”œâ”€â”€ card_config.py       # CardConfig model
â”‚   â”‚   â””â”€â”€ token_transaction.py # TokenTransaction model
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ ...                  # Pydantic schemas (request/response)
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ pages.py             # HTML é é¢è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ cards.py             # å¡ç‰Œç›¸é—œ API
â”‚   â”‚   â”œâ”€â”€ learning.py          # å­¸ç¿’æ­·ç¨‹ API
â”‚   â”‚   â”œâ”€â”€ generation.py        # åœ–ç‰‡ç”Ÿæˆè«‹æ±‚ API
â”‚   â”‚   â”œâ”€â”€ admin.py             # æ•™å¸«ç®¡ç†å¾Œå°è·¯ç”±
â”‚   â”‚   â””â”€â”€ internal.py          # VM é–“å…§éƒ¨å›èª¿ API
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py              # Cloudflare èªè­‰è™•ç† + è‡ªåŠ©è¨»å†Š
â”‚   â”‚   â”œâ”€â”€ storage.py           # vm-db-storage é€£æ¥ï¼ˆå« mockï¼‰
â”‚   â”‚   â”œâ”€â”€ ai_worker.py         # vm-ai-worker é€£æ¥ï¼šé€å‡ºå­¸ç¿’æ•¸æ“š+é…ç½®ï¼ˆå« mockï¼‰
â”‚   â”‚   â””â”€â”€ scoring.py           # è©•åˆ†â†’è§’è‰²å±¬æ€§è½‰æ›è¦å‰‡å¼•æ“
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ base.html            # åŸºç¤æ¨¡æ¿ï¼ˆåƒç´ é¢¨æ ¼æ¡†æ¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ index.html           # é¦–é /å„€è¡¨æ¿
â”‚   â”‚   â”œâ”€â”€ cards/
â”‚   â”‚   â”‚   â”œâ”€â”€ gallery.html     # å¡ç‰Œ gallery
â”‚   â”‚   â”‚   â””â”€â”€ detail.html      # å–®å¼µå¡ç‰Œè©³æƒ…
â”‚   â”‚   â”œâ”€â”€ hall.html            # è§’è‰²å¤§å»³
â”‚   â”‚   â”œâ”€â”€ learning/
â”‚   â”‚   â”‚   â”œâ”€â”€ progress.html    # å­¸ç¿’æ­·ç¨‹ç¸½è¦½
â”‚   â”‚   â”‚   â””â”€â”€ unit_detail.html # å–®ä¸€å–®å…ƒè©³æƒ… + é…ç½®
â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard.html   # æ•™å¸«å„€è¡¨æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ students.html    # å­¸ç”Ÿç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ import.html      # æˆç¸¾åŒ¯å…¥
â”‚   â”‚   â””â”€â”€ errors/
â”‚   â”‚       â”œâ”€â”€ register.html       # è‡ªåŠ©è¨»å†Šé é¢
â”‚   â”‚       â””â”€â”€ 404.html
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ css/
â”‚       â”‚   â””â”€â”€ style.css        # è‡ªå®šç¾©åƒç´ é¢¨æ ¼ CSS
â”‚       â”œâ”€â”€ js/
â”‚       â”‚   â””â”€â”€ app.js           # HTMX é…ç½® + äº’å‹•é‚è¼¯
â”‚       â”œâ”€â”€ fonts/               # åƒç´ é¢¨æ ¼å­—å‹
â”‚       â””â”€â”€ images/
â”‚           â”œâ”€â”€ ui/              # UI åƒç´ å…ƒç´ ï¼ˆé‚Šæ¡†ã€åœ–æ¨™ç­‰ï¼‰
â”‚           â””â”€â”€ placeholder/     # é–‹ç™¼ç”¨ä½”ä½åœ–
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py              # pytest fixturesï¼ˆæ¸¬è©¦ç”¨ DBã€client ç­‰ï¼‰
â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”œâ”€â”€ test_scoring.py          # è©•åˆ†è½‰æ›è¦å‰‡æ¸¬è©¦
â”‚   â”œâ”€â”€ test_routers/
â”‚   â”‚   â”œâ”€â”€ test_pages.py
â”‚   â”‚   â”œâ”€â”€ test_cards.py
â”‚   â”‚   â””â”€â”€ test_admin.py
â”‚   â””â”€â”€ test_services/
â”‚       â”œâ”€â”€ test_storage.py
â”‚       â””â”€â”€ test_ai_worker.py
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ seed_data.py             # åˆå§‹è³‡æ–™è¼‰å…¥ï¼ˆå–®å…ƒå®šç¾©ã€æ¸¬è©¦å­¸ç”Ÿç­‰ï¼‰
â””â”€â”€ ref/                         # åƒè€ƒæ–‡ä»¶ï¼ˆä¸å…¥ç‰ˆæ§éƒ¨ç½²ï¼‰
```

---

## 8. Mock / Stub ç­–ç•¥

ç”±æ–¼ vm-ai-worker å’Œ vm-db-storage å°šæœªä¸Šç·šï¼Œé–‹ç™¼éšæ®µä½¿ç”¨ä»¥ä¸‹ mock ç­–ç•¥ï¼š

### 8.1 AI Worker Mock

`app/services/ai_worker.py` æä¾›çµ±ä¸€ä»‹é¢ï¼š

```python
class AIWorkerService:
    async def submit_generation(self, card_id: int, card_config: dict, learning_data: dict) -> str:
        """é€å‡ºå­¸ç¿’æ•¸æ“šèˆ‡è§’è‰²é…ç½®ï¼Œç”± ai-worker è² è²¬ç”Ÿæˆ prompt ä¸¦è£½åœ–ã€‚å›å‚³ job_id"""
        ...

    async def check_job_status(self, job_id: str) -> dict:
        """æŸ¥è©¢ä»»å‹™ç‹€æ…‹"""
        ...
```

Mock å¯¦ä½œï¼š
- `submit_generation` ç«‹å³å›å‚³å‡ job_idï¼ˆä¸ç”Ÿæˆ promptï¼Œå› ç‚ºçœŸå¯¦ç’°å¢ƒç”± ai-worker çš„ LLM è™•ç†ï¼‰
- æ¨¡æ“¬ 3-5 ç§’å»¶é²å¾Œè‡ªå‹•è§¸ç™¼ callback
- å›å‚³é ç½®çš„ç¤ºç¯„å¡ç‰Œåœ–ç‰‡è·¯å¾‘

### 8.2 Storage Mock

`app/services/storage.py` æä¾›çµ±ä¸€ä»‹é¢ï¼š

```python
class StorageService:
    async def get_image(self, image_path: str) -> bytes:
        """è®€å–åœ–ç‰‡"""
        ...

    async def list_images(self, student_id: int) -> list:
        """åˆ—å‡ºå­¸ç”Ÿæ‰€æœ‰åœ–ç‰‡"""
        ...
```

Mock å¯¦ä½œï¼š
- å¾ `app/static/images/placeholder/` è®€å–é ç½®çš„ç¤ºç¯„åœ–ç‰‡
- å›å‚³å›ºå®šçš„ metadata

### 8.3 ç’°å¢ƒåˆ‡æ›

é€é `app/config.py` è®€å–ç’°å¢ƒè®Šæ•¸æ§åˆ¶ï¼š

```
# .env
USE_MOCK_AI_WORKER=true
USE_MOCK_STORAGE=true
AI_WORKER_BASE_URL=http://192.168.50.110
DB_STORAGE_BASE_URL=http://192.168.50.112
```

---

## 9. Agent Team ä»»å‹™åˆ†é…

### 9.1 åœ˜éšŠæˆå“¡

| è§’è‰² | Agent åç¨± | è·è²¬ |
|------|-----------|------|
| åœ˜éšŠé ˜å° | team-lead | ä»»å‹™åˆ†é…ã€æ•´åˆå”èª¿ã€æ¶æ§‹æ±ºç­–ã€ç¨‹å¼ç¢¼å¯©æŸ¥ |
| å‰ç«¯å·¥ç¨‹å¸« | frontend-dev | Jinja2 æ¨¡æ¿ã€CSS åƒç´ é¢¨æ ¼ã€HTMX äº’å‹•ã€éŸ¿æ‡‰å¼è¨­è¨ˆ |
| å¾Œç«¯å·¥ç¨‹å¸« | backend-dev | FastAPI æ¶æ§‹ã€è·¯ç”±ã€middlewareã€DB è¨­å®šã€å°ˆæ¡ˆçµæ§‹ |
| è³‡æ–™æ•´åˆå·¥ç¨‹å¸« | data-integrator | è³‡æ–™æ¨¡å‹ã€è©•åˆ†è¦å‰‡å¼•æ“ã€prompt builderã€CSV åŒ¯å…¥ |
| é€£æ¥æœå‹™å·¥ç¨‹å¸« | storage-connector | storage/ai_worker service ä»‹é¢èˆ‡ mockã€å…§éƒ¨ API |
| æ¸¬è©¦å·¥ç¨‹å¸« | test-engineer | pytest æ¶æ§‹ã€conftestã€å„æ¨¡çµ„å–®å…ƒæ¸¬è©¦ |

### 9.2 ç¬¬ä¸€éšæ®µä»»å‹™

**Phase 3A â€” åŸºç¤éª¨æ¶ï¼ˆå¯ä¸¦è¡Œï¼‰**

| # | ä»»å‹™ | è² è²¬ | å‰ç½®ä¾è³´ |
|---|------|------|----------|
| T1 | å»ºç«‹ç›®éŒ„çµæ§‹ + å®‰è£ä¾è³´ (uv add) + .env è¨­å®š | backend-dev | ç„¡ |
| T2 | è³‡æ–™æ¨¡å‹å®šç¾© (SQLAlchemy models) + DB åˆå§‹åŒ– | data-integrator | T1 |
| T3 | pytest åŸºç¤æ¶æ§‹ + conftest | test-engineer | T1 |
| T4 | base.html åƒç´ é¢¨æ ¼æ¨¡æ¿ + static assets | frontend-dev | T1 |
| T5 | storage + ai_worker service ä»‹é¢ + mock | storage-connector | T1 |

**Phase 3B â€” æ ¸å¿ƒåŠŸèƒ½ï¼ˆåœ¨ 3A å®Œæˆå¾Œï¼‰**

| # | ä»»å‹™ | è² è²¬ | å‰ç½®ä¾è³´ |
|---|------|------|----------|
| T6 | FastAPI app é‡æ§‹ + router æ‹†åˆ† + auth middleware | backend-dev | T1 |
| T7 | è©•åˆ†è½‰æ›è¦å‰‡å¼•æ“ (scoring.py) | data-integrator | T2 |
| T8 | è‡ªåŠ©è¨»å†Šé é¢ + æµç¨‹ | frontend-dev + backend-dev | T4, T6 |
| T9 | é¦–é å„€è¡¨æ¿ + å­¸ç¿’æ­·ç¨‹é é¢ | frontend-dev | T4, T6 |
| T10 | å¡ç‰Œ gallery + detail + è§’è‰²å¤§å»³é é¢ | frontend-dev | T4, T6 |
| T11 | å¡ç‰Œç”Ÿæˆæµç¨‹ API (generation router) | backend-dev | T5, T6, T8 |
| T12 | æ•™å¸«ç®¡ç†å¾Œå° + CSV åŒ¯å…¥ | backend-dev + data-integrator | T6, T2 |
| T13 | å„æ¨¡çµ„å–®å…ƒæ¸¬è©¦ | test-engineer | T6-T12 |

---

## 10. ç’°å¢ƒèˆ‡éƒ¨ç½²

### 10.1 é–‹ç™¼ç’°å¢ƒ

```bash
# å®‰è£ä¾è³´
uv sync

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
uv run uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### 10.2 ç’°å¢ƒè®Šæ•¸ (.env.example)

```env
# æ‡‰ç”¨è¨­å®š
APP_ENV=development
APP_DEBUG=true
APP_SECRET_KEY=change-me-in-production

# è³‡æ–™åº«
DATABASE_URL=sqlite+aiosqlite:///./data/scholaverse.db

# å¤–éƒ¨ VM æœå‹™
AI_WORKER_BASE_URL=http://192.168.50.110
DB_STORAGE_BASE_URL=http://192.168.50.112
USE_MOCK_AI_WORKER=true
USE_MOCK_STORAGE=true

# Cloudflare
CF_AUTH_HEADER=cf-access-authenticated-user-email
```

### 10.3 Git åˆ†æ”¯ç­–ç•¥

- `main`ï¼šç©©å®šç‰ˆæœ¬
- `develop`ï¼šé–‹ç™¼æ•´åˆåˆ†æ”¯
- `feature/*`ï¼šå„åŠŸèƒ½åˆ†æ”¯ï¼ˆå¦‚ `feature/auth-middleware`, `feature/card-gallery`ï¼‰

---

## 11. å¾…ç¢ºèªäº‹é …

| # | é …ç›® | ç‹€æ…‹ |
|---|------|------|
| 1 | vm-ai-worker / vm-db-storage å¯¦éš› API è¦æ ¼ | å¾… VM å»ºç«‹å¾Œç¢ºèª |
| 2 | ç”Ÿæˆå¼ AI æ¨¡å‹é¸å‹ï¼ˆFLUX.1 / Stable Diffusionï¼‰åŠ LLM é¸å‹ | å¾… GPU VM å°±ç·’å¾Œè©•ä¼° |
| 3 | TronClass æˆç¸¾åŒ¯å‡º CSV æ ¼å¼ | å¾…å–å¾—ç¯„ä¾‹æª”æ¡ˆ |
| 4 | åƒç´ é¢¨æ ¼ UI ç´ æï¼ˆé‚Šæ¡†ã€åœ–æ¨™ spriteï¼‰ | å¯å…ˆç”¨ AI ç”Ÿæˆæˆ–é–‹æºç´ æ |
| 5 | è§’è‰²å±¬æ€§é¸é …çš„å®Œæ•´æ¸…å–® | é–‹ç™¼ä¸­é€æ­¥å®Œå–„ |
| 6 | vm-ai-worker ä¸Š LLM prompt ç”Ÿæˆé‚è¼¯è¨­è¨ˆ | å¾… ai-worker é–‹ç™¼æ™‚è™•ç† |
